<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéì Yearbook Generator</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #1a3a5f;
      font-weight: 700;
    }

    .section {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .upload-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .upload-area {
      border: 2px dashed #4a90e2;
      border-radius: 10px;
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s ease;
      background: #f8fbff;
    }

    .upload-area:hover {
      background: #eaf4ff;
      border-color: #2c7be5;
    }

    .upload-area p {
      margin: 10px 0;
      font-size: 16px;
      color: #2c3e50;
    }

    .upload-area strong {
      display: block;
      margin-top: 8px;
      font-size: 14px;
      color: #7f8c8d;
    }

    .settings {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      margin-top: 16px;
    }

    .settings label {
      font-weight: 600;
      font-size: 15px;
    }

    .settings input {
      width: 70px;
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
    }

    button {
      padding: 10px 20px;
      background: #2c7be5;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.2s;
    }

    button:hover {
      background: #1a5fb4;
    }

    button:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }

    /* ‚úÖ Main output: clean vertical stack */
    #yearbook-output {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    #yearbook-output .folder-name {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 24px;
      color: #1a3a5f;
      padding-bottom: 12px;
      border-bottom: 2px solid #eee;
    }

    /* ‚úÖ Main grid: full rows only */
    #yearbook-grid {
      display: grid;
      gap: 24px;
      justify-items: center;
      width: 100%;
    }

    /* ‚úÖ Last-row container: centered block */
    #last-row-wrapper {
      display: flex;
      justify-content: center;
      width: 100%;
      margin-top: 24px;
    }

    /* ‚úÖ Last-row grid: same gap & spacing as main grid */
    #last-row-grid {
      display: grid;
      gap: 24px;
      justify-items: center;
      /* Cards auto-size, no explicit columns needed */
    }

    .student-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .student-card img {
      width: 140px;
      height: 140px;
      object-fit: cover;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      aspect-ratio: 1 / 1;
    }

    .student-card .name {
      margin-top: 14px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      color: #1a3a5f;
      line-height: 1.4;
    }

    /* Responsive */
    @media (max-width: 768px) {
      #yearbook-output {
        padding: 20px 15px;
      }
      #yearbook-grid,
      #last-row-grid {
        gap: 16px;
      }
      .student-card img {
        width: 120px;
        height: 120px;
      }
    }

    @media print {
      body * { visibility: hidden; }
      #yearbook-output,
      #yearbook-output * {
        visibility: visible;
      }
      #yearbook-output {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: auto;
        padding: 20px;
        background: white !important;
        box-shadow: none;
      }
      #last-row-wrapper {
        page-break-inside: avoid;
      }
    }

    .instructions {
      font-size: 14px;
      color: #7f8c8d;
      margin-top: 6px;
      font-style: italic;
    }

    /* Adjustable gap control */
.gap-control {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 12px;
  padding: 12px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #e0e6ed;
}

.gap-control label {
  font-weight: 600;
  font-size: 14px;
  color: #34495e;
  white-space: nowrap;
}

.gap-slider {
  flex: 1;
  height: 6px;
  -webkit-appearance: none;
  background: #dfe6f1;
  border-radius: 3px;
  outline: none;
}

.gap-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  background: #2c7be5;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.gap-input {
  width: 60px;
  padding: 4px 8px;
  text-align: center;
  border: 1px solid #bdc3c7;
  border-radius: 4px;
  font-size: 14px;
}

/* Highlight last row when gap differs from main grid */
.last-row-different {
  background: #f0f7ff;
  padding: 16px;
  border-radius: 8px;
  border: 1px dashed #4a90e2;
}


  </style>
</head>
<body>
  <div class="container">
    <h1>üéì Yearbook Generator</h1>

    <div class="section">
      <div class="upload-grid">
        <div class="upload-area" id="folderDrop">
          <p>üìÅ Drop folder of student photos</p>
          <p><em>(e.g., <code>Jhon Dumanhog.jpeg</code>, <code>Hubert Cabal.webp</code>)</em></p>
          <p class="instructions">üí° Chrome/Edge: drag folder. Others: select multiple files.</p>
          <input type="file" id="folderInput" webkitdirectory directory multiple hidden />
        </div>

        <div class="upload-area" id="bgDrop">
          <p>üñºÔ∏è Drop background image</p>
          <p><em>(optional ‚Äî JPEG/PNG)</em></p>
          <input type="file" id="bgInput" accept="image/*" hidden />
        </div>
      </div>

      <div class="settings">
        <label>Columns: <input type="number" id="cols" min="2" max="10" value="5" /></label>
        <label>Rows: <input type="number" id="rows" min="1" max="20" value="4" /></label>
        
        <button id="generateBtn" disabled>üîÑ Generate Yearbook</button>
        <button id="printBtn" disabled>üñ®Ô∏è Print / Save as PDF</button>
      </div>

      <!-- ‚úÖ Gap Control for Last Row (max gap = 500px) -->
      <div class="gap-control" id="gapControl" style="display: none;">
        <label for="lastRowGap">Last Row Gap:</label>
        <input type="range" id="lastRowGapSlider" class="gap-slider" min="0" max="500" value="24" step="1" />
        <input type="number" id="lastRowGapInput" class="gap-input" min="0" max="500" value="24" />
        <button id="resetGapBtn" title="Reset to main grid gap (24px)">‚Ü∫</button>
      </div>
    </div>

    <div class="section">
      <div id="yearbook-output">
        <div class="folder-name" id="folderName">üìÅ No folder selected</div>
        <div id="yearbook-grid"></div>
        <div id="last-row-wrapper" style="display: none;">
          <div id="last-row-grid"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
  let studentFiles = [];
  let folderName = '';
  let bgUrl = null;
  let lastRowGap = 24; // Default to match main grid

  // DOM Elements
  const folderDrop = document.getElementById('folderDrop');
  const folderInput = document.getElementById('folderInput');
  const bgDrop = document.getElementById('bgDrop');
  const bgInput = document.getElementById('bgInput');
  const colsInput = document.getElementById('cols');
  const rowsInput = document.getElementById('rows');
  const generateBtn = document.getElementById('generateBtn');
  const printBtn = document.getElementById('printBtn');
  const folderNameEl = document.getElementById('folderName');
  const yearbookGrid = document.getElementById('yearbook-grid');
  const lastRowWrapper = document.getElementById('last-row-wrapper');
  const lastRowGrid = document.getElementById('last-row-grid');
  const yearbookOutput = document.getElementById('yearbook-output');
  const gapControl = document.getElementById('gapControl');
  const lastRowGapSlider = document.getElementById('lastRowGapSlider');
  const lastRowGapInput = document.getElementById('lastRowGapInput');
  const resetGapBtn = document.getElementById('resetGapBtn');

  // Clean name function (unchanged)
  function cleanName(filename) {
    return filename
      .replace(/\.[^/.]+$/, '')
      .replace(/[_-]/g, ' ')
      .split(' ')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
      .join(' ')
      .trim();
  }

  // Create student card (unchanged)
  function createStudentCard(student) {
    const card = document.createElement('div');
    card.className = 'student-card';

    const img = document.createElement('img');
    img.src = URL.createObjectURL(student.file);
    img.alt = student.name;
    img.loading = 'lazy';

    const nameEl = document.createElement('div');
    nameEl.className = 'name';
    nameEl.textContent = student.name;

    card.appendChild(img);
    card.appendChild(nameEl);
    return card;
  }

  // Folder upload handlers (unchanged)
  function setupFolderUpload() {
    folderDrop.addEventListener('click', () => folderInput.click());

    folderInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files).filter(f =>
        f.type.startsWith('image/') && /\.(jpe?g|png|webp|gif)$/i.test(f.name)
      );
      processFiles(files);
    });

    folderDrop.addEventListener('dragover', (e) => {
      e.preventDefault();
      folderDrop.style.backgroundColor = '#e3f2fd';
      folderDrop.style.borderColor = '#2196f3';
    });

    folderDrop.addEventListener('dragleave', () => {
      folderDrop.style.backgroundColor = '';
      folderDrop.style.borderColor = '';
    });

    folderDrop.addEventListener('drop', (e) => {
      e.preventDefault();
      folderDrop.style.backgroundColor = '';
      folderDrop.style.borderColor = '';

      let items = [];
      if (e.dataTransfer.items) {
        for (let i = 0; i < e.dataTransfer.items.length; i++) {
          const item = e.dataTransfer.items[i];
          if (item.kind === 'file') {
            const file = item.getAsFile();
            items.push(file);
          }
        }
      } else {
        items = Array.from(e.dataTransfer.files);
      }

      const imageFiles = items.filter(f =>
        f.type.startsWith('image/') && /\.(jpe?g|png|webp|gif)$/i.test(f.name)
      );
      processFiles(imageFiles);
    });
  }

  function processFiles(files) {
    if (files.length === 0) {
      alert('‚ö†Ô∏è No image files found. Please upload images (JPEG, PNG, WEBP).');
      return;
    }

    const firstFile = files[0];
    folderName = firstFile.webkitRelativePath ? firstFile.webkitRelativePath.split('/')[0] : 'Student Photos';

    studentFiles = files.map(file => ({
      file,
      name: cleanName(file.name)
    }));

    folderNameEl.textContent = `üìÅ ${folderName} (${studentFiles.length} student${studentFiles.length !== 1 ? 's' : ''})`;
    generateBtn.disabled = false;
    printBtn.disabled = false;
  }

  // Background upload (unchanged)
  function setupBgUpload() {
    bgDrop.addEventListener('click', () => bgInput.click());

    bgInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = () => {
          bgUrl = reader.result;
          updateBackground();
        };
        reader.readAsDataURL(file);
      }
    });

    bgDrop.addEventListener('dragover', (e) => {
      e.preventDefault();
      bgDrop.style.backgroundColor = '#e3f2fd';
      bgDrop.style.borderColor = '#2196f3';
    });

    bgDrop.addEventListener('dragleave', () => {
      bgDrop.style.backgroundColor = '';
      bgDrop.style.borderColor = '';
    });

    bgDrop.addEventListener('drop', (e) => {
      e.preventDefault();
      bgDrop.style.backgroundColor = '';
      bgDrop.style.borderColor = '';
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        bgInput.files = e.dataTransfer.files;
        const reader = new FileReader();
        reader.onload = () => {
          bgUrl = reader.result;
          updateBackground();
        };
        reader.readAsDataURL(file);
      }
    });
  }

  function updateBackground() {
    if (bgUrl) {
      yearbookOutput.style.backgroundImage = `url(${bgUrl})`;
      yearbookOutput.style.backgroundSize = 'cover';
      yearbookOutput.style.backgroundPosition = 'center';
      yearbookOutput.style.backgroundRepeat = 'no-repeat';
    } else {
      yearbookOutput.style.background = 'white';
    }
  }

  // üî• Enhanced Yearbook Generator
  function generateYearbook() {
    const cols = Math.max(2, parseInt(colsInput.value) || 5);
    const rows = Math.max(1, parseInt(rowsInput.value) || 4);
    const maxCount = cols * rows;

    const displayStudents = studentFiles.slice(0, maxCount);
    
    // Clear
    yearbookGrid.innerHTML = '';
    lastRowGrid.innerHTML = '';
    lastRowWrapper.style.display = 'none';
    lastRowWrapper.classList.remove('last-row-different');

    if (displayStudents.length === 0) {
      yearbookGrid.innerHTML = '<p style="text-align: center; color: #7f8c8d;">No students to display.</p>';
      gapControl.style.display = 'none';
      return;
    }

    const total = displayStudents.length;
    const fullRowCount = Math.floor(total / cols);
    const fullRowsItemCount = fullRowCount * cols;
    const remainingCount = total - fullRowsItemCount;

    // üîπ Render full rows in main grid
    for (let i = 0; i < fullRowsItemCount; i++) {
      yearbookGrid.appendChild(createStudentCard(displayStudents[i]));
    }

    // Set grid columns for full rows
    yearbookGrid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

    // üîπ Handle remaining items (1 to cols-1)
    if (remainingCount > 0) {
      for (let i = fullRowsItemCount; i < total; i++) {
        lastRowGrid.appendChild(createStudentCard(displayStudents[i]));
      }

      // ‚úÖ Apply user-defined gap to last row
      const mainGap = 24; // Fixed main grid gap (from CSS)
      lastRowGrid.style.gap = `${lastRowGap}px`;
      lastRowGrid.style.gridTemplateColumns = `repeat(${remainingCount}, 1fr)`;

      // ‚úÖ Visual cue if gap differs
      if (lastRowGap !== mainGap) {
        lastRowWrapper.classList.add('last-row-different');
      }

      lastRowWrapper.style.display = 'flex';
      gapControl.style.display = 'flex';
    } else {
      gapControl.style.display = 'none';
    }

    updateBackground();
  }

  // üîÑ Reset gap to match main grid
  function resetLastRowGap() {
    lastRowGap = 24;
    lastRowGapSlider.value = 24;
    lastRowGapInput.value = 24;
    if (lastRowWrapper.style.display !== 'none') {
      generateYearbook(); // Regenerate to apply
    }
  }

  // üñ®Ô∏è Print
  function printYearbook() {
    window.print();
  }

  // üéõÔ∏è Gap sync logic
  function syncGap() {
  let sliderVal = parseInt(lastRowGapSlider.value) || 24;
  let inputVal = parseInt(lastRowGapInput.value) || 24;

  // Clamp between 0 and 500
  sliderVal = Math.min(500, Math.max(0, sliderVal));
  inputVal = Math.min(500, Math.max(0, inputVal));

  // Use tighter coupling: prioritize slider on input blur, but sync both
  lastRowGap = sliderVal; // slider drives the value

  // Sync both fields to clamped value
  lastRowGapSlider.value = lastRowGap;
  lastRowGapInput.value = lastRowGap;

  // Apply live if last row is visible
  if (lastRowWrapper.style.display !== 'none') {
    lastRowGrid.style.gap = `${lastRowGap}px`;
    const mainGap = 24;
    lastRowWrapper.classList.toggle('last-row-different', lastRowGap !== mainGap);
  }
}
  // ‚ûï Init new controls
  function initGapControls() {
    lastRowGapSlider.addEventListener('input', syncGap);
    lastRowGapInput.addEventListener('change', () => {
      let val = parseInt(lastRowGapInput.value);
      if (isNaN(val)) val = 24;
      val = Math.min(500, Math.max(0, val));
      lastRowGapSlider.value = val;
      syncGap();
    });
    resetGapBtn.addEventListener('click', resetLastRowGap);
  }

  // üöÄ Init
  function init() {
    setupFolderUpload();
    setupBgUpload();
    initGapControls();
    generateBtn.addEventListener('click', generateYearbook);
    printBtn.addEventListener('click', printYearbook);
    yearbookOutput.style.background = 'white';
  }

  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>